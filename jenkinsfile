pipeline {
 agent any

 stages {
  stage('Clone Code') {
   steps {
    git 'https://github.com/iamonkarlad/Student-Registration-flask-app-using-Jenkins.git'
   }
  }

    stage('Deploy to App Server') {
    steps {
        sh '''
        ssh -o StrictHostKeyChecking=no ubuntu@172.31.23.172 << EOF
            if [ ! -d Student-Registration-flask-app-using-Jenkins ]; then
                git clone https://github.com/iamonkarlad/Student-Registration-flask-app-using-Jenkins.git
            fi

            cd Student-Registration-flask-app-using-Jenkins
            git pull origin master
            pip3 install -r requirements.txt
            pkill -f app.py || true
            nohup python3 app.py > app.log 2>&1 &
        EOF
        '''
    }
}
 }
}
